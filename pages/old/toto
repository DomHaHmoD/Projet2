SELECT  carte_abonnement.id_type_ab     AS 'N° ABONNEMENT' ,type_abonnement.denom_ab     AS 'TYPE ABONNEMENT'

/* somme des tarifs d'abonnements + somme des duplicatas - somme des résiliations */
,CONCAT(( (sum(if( year(carte_abonnement.date_paiement) = year('2017/05/01'), if(prix_duplicata != 0, 0, histo_tarif_abo.tarif),0))) + (sum(if(year(duplicata.date_duplicata) = year('2017/05/01'), duplicata.prix_duplicata, 0))) - (sum(if(year(resilie.date_resiliation) =year('2017/05/01'), if(prix_duplicata != 0, 0, resilie.montant_remb)   ,0 )))),'€')      AS 'CHIFFRE D AFFAIRE TOTAL SUR L ANNEE'

, year('2017/05/01')      AS 'ANNEE'

FROM carte_abonnement INNER JOIN type_abonnement ON carte_abonnement.id_type_ab = type_abonnement.id_type_ab INNER JOIN histo_tarif_abo ON carte_abonnement.id_type_ab = histo_tarif_abo.id_type_ab left JOIN duplicata ON carte_abonnement.id_abonnement = duplicata.id_abonnement left join resilie ON carte_abonnement.id_abonnement = resilie.id_abonnement

/*CONDITIONS POUR SELECTIONNER LES TARIFS CORRESPONDANTS A L'ANNEE CHOISIE*/      WHERE (year(histo_tarif_abo.date_prise_effet) = year('2017/05/01') )       GROUP BY type_abonnement.denom_ab order by carte_abonnement.id_type_ab;